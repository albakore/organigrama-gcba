<html>
    <head>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@200;300;400&display=swap" rel="stylesheet">
    </head>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

  <body>
    <style>
      .card{
		    font-family: 'Nunito',sans-serif;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius:10px;
        border: 2px solid #f0f0f0;
        padding : 10px;
				border-radius:10px;
				border: 2px solid #f0f0f0;
      }
     .card:hover{
        border: 2px solid #005387 !important;
      }
    .card:hover, .card:hover .name{
      color: #005387 !important;
      text-decoration: underline;
      }
    .name{
      font-size:15px;
      color:#38485C;
      margin-left:20px;
    }


    </style>
	<input
	type="search"
	placeholder="search by name"
	oninput="filterChart(event)"
	/>
    <div class="chart-container" style="border-radius: 10px;  box-shadow: inset 0 0 10px #494949;"></div>

  </body>

  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/d3-org-chart@3.0.1"></script>
  <script src="https://cdn.jsdelivr.net/npm/d3-flextree@2.1.2/build/d3-flextree.js"></script>

  <script>

	let chart;

	function filterChart(e) {

		// Get input value
		const value = e.srcElement.value;

		// Clear previous higlighting
		chart.clearHighlighting();

		// Get chart nodes
		const data = chart.data();

		// Mark all previously expanded nodes for collapse
		data.forEach((d) => (d._expanded = false));

		// Loop over data and check if input value matches any name
		data.forEach((d) => {
		if (value != '' && d.name.toLowerCase().includes(value.toLowerCase())) {
			// If matches, mark node as highlighted
			d._highlighted = true;
			d._expanded = true;
		}
		});

		// Update data and rerender graph
		chart.data(data).render().fit();

		console.log('filtering chart', e.srcElement.value);
	}

	d3.csv(
	  'https://raw.githubusercontent.com/bumbeishvili/sample-data/main/data-oracle.csv'
	).then((data) => {
	  chart = new d3.OrgChart()
		.nodeHeight((d) => 85 + 25) // Largo de cada nodo
		.nodeWidth((d) => 220 + 2) // Ancho de cada nodo
		.childrenMargin((d) => 30) // Margin entre padre/hijo
		.compactMarginBetween((d) => 50)
		.compactMarginPair((d) => 50) //
		.neighbourMargin((a, b) => 20)
		.nodeContent(function (d, i, arr, state) {
		  const color = '#fffff';
		  const imageDiffVert = 15 + 3; //Margin top de la imagen. (Para modificar su posici√≥n en eje x)



		  return `
			<div
            style=
            'width:${d.width}px;
            height:${d.height}px;
            padding-top:${imageDiffVert - 2}px;
            padding-left:1px;
            padding-right:1px'
            '
          	>
			  <div class="card"
			  style="

			  background-color:${color};

			  ">
				  <img src=" ${d.data.image}"
				  style="
				  border-radius:100px;
				  width:50px;
				  height:50px;
				  border: 2px solid #f0f0f0
				  "/>
					  <div class="name" style="">  ${d.data.name} </div>
					  <div style="color:#716E7B;margin-left:20px;margin-top:3px;font-size:10px;"> ${d.data.position} </div>

			  </div>
			</div>
			`;
		})

		.container('.chart-container')
		.data(data)
		.render();
	});
  </script>

</html>